<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tech Note Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tech Note Blog Atom Feed"><title data-react-helmet="true">Posts tagged &quot;facebook&quot; | Tech Note</title><meta data-react-helmet="true" property="og:title" content="Posts tagged &quot;facebook&quot; | Tech Note"><meta data-react-helmet="true" name="description" content="Blog | Tagged &quot;facebook&quot;"><meta data-react-helmet="true" property="og:description" content="Blog | Tagged &quot;facebook&quot;"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/blog/tags/facebook"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="shortcut icon" href="/img/oke_logo.png"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/blog/tags/facebook"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/blog/tags/facebook" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/blog/tags/facebook" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5b4c1d60.css">
<link rel="preload" href="/assets/js/runtime~main.2fa7534d.js" as="script">
<link rel="preload" href="/assets/js/main.6a1dc008.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/oke_logo.png" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/oke_logo.png" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/docs/intro">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><div class="searchWrapper_3rmH"><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/oke_logo.png" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/oke_logo.png" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/balancer">Sử dụng NGINX làm load balancer</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/ssl">Let&#x27;s Encrypt SSL</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/kubeadm">Steps to Install Kubeadm on Ubuntu</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/minikubeancer">Minikube Installation on Ubuntu 16.04 LTS</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/httpaccess">Nginx Protecting directories</a></li></ul></div></div><main class="col col--7"><h1>5 posts tagged with &quot;facebook&quot;</h1><a href="/blog/tags">View All Tags</a><div class="margin-vert--xl"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/balancer">Sử dụng NGINX làm load balancer</a></h2><div class="margin-vert--md"><time datetime="2021-05-06T00:00:00.000Z" class="blogPostDate_fNvV">May 6, 2021 · 6 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/ttl" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars0.githubusercontent.com/u/1315101?s=400&amp;v=4" alt="congnt"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/ttl" target="_blank" rel="noopener noreferrer">congnt</a></h4><small class="avatar__subtitle">BACKEND</small></div></div></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sử-dụng-nginx-làm-load-balancer"></a>Sử dụng NGINX làm load balancer<a class="hash-link" href="#sử-dụng-nginx-làm-load-balancer" title="Direct link to heading">#</a></h2><p>Sử dụng 3 server đều cài nginx</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">instance loadbalance: docker run -p 22:22 --name=loadbalance -p 22:22 -p 80:80 congttl/ubuntu:latest</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">instance webserver1:  docker run -p 22:22 --name=webserver1  -p 23:22 -p 81:80 congttl/ubuntu:latest</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">instance webserver2:  docker run -p 22:22 --name=webserver2  -p 24:22 -p 80:80 congttl/ubuntu:latest</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Cả 2 webserver 1 và 2 điều chứa src code</p><blockquote><p>Công việc của chúng ta là cấu hình sao cho khi người dùng truy cập vào vhost thì Master server sẽ điều hướng tới một trong hai Backend server, đồng thời không để mất session người dùng.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cấu-hình-upstream-trên-instance-master"></a>Cấu hình Upstream trên instance master<a class="hash-link" href="#cấu-hình-upstream-trên-instance-master" title="Direct link to heading">#</a></h2><p>Để bắt đầu sử dụng NGINX với một nhóm các máy chủ web, đầu tiên, bạn cần khai báo upstream group.</p><p>trong file /etc/nginx/site-avaliables/default</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">upstream backend {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  server: webserver1 -&gt; chúng ta có thể thay bằng địa chỉ IP tương ứng</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  server: webserver2 -&gt; chúng ta có thể thay bằng địa chỉ IP tương ứng</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Để truyền cái request từ người dùng vào một group server, tên của group được truyền vào với direct <code>proxy_pass</code> hoặc <code>(fastcgi_pass, memcached_pass, uwsgi_pass, scgi_pass)</code> tùy thuộc vào giao thức</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">server {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  location / {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    proxy_pass http://backend</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Kết hoặc lại </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">upstream backend {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    server backend1;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    server backend2;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">server {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    location / {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        proxy_pass http://backend;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="lựa-chọn-thuật-toán-cân-bằng-tải"></a>Lựa chọn thuật toán cân bằng tải<a class="hash-link" href="#lựa-chọn-thuật-toán-cân-bằng-tải" title="Direct link to heading">#</a></h3><p>Có rất nhiều thuật toán cho mọi người lựa chọn như round-robin, least_conn, least_time, ip_hash, ...</p><blockquote><p>Trong bài viết này mình lựa chọn round-robin: Các request lần lượt được đẩy về 2 server webserver1 và webserver2 theo tỉ lệ dựa trên server weights, ở đây là 1:1</p></blockquote><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">upstream backend {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  server webserver1;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  server webserver2;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="bảo-toàn-session-người-dùng"></a>Bảo toàn session người dùng<a class="hash-link" href="#bảo-toàn-session-người-dùng" title="Direct link to heading">#</a></h3><p>Hãy thử tưởng tượng bạn có một ứng dụng yêu cầu đăng nhập, nếu khi đăng nhập, session lưu trên Webserver 1, sau một hồi request lại được chuyển tới Webserver 2, trạng thái đăng nhập bị mất, hẳn là người dùng sẽ vô cùng nản</p><p>Để giải quyết vấn đề này, chúng ta có thể lưu session vào memcached hoặc redis.
Nhưng đơn giản chỉ vì việc đồng bộ hóa session giữa 2 server memcached diễn ra quá chậm, bị ảnh hưởng bởi yếu tố Network, I/O</p><p>Nhanh gọn hơn NGINX có cung cấp <code>sticky directive</code>, giúp NGINX tracks user sessions và đưa họ tới đúng upstream server.</p><p>Tuy nhiên, vấn đề ở chỗ NGINX chỉ cung cấp giải pháp này cho phiên bản thương mại: NGINX Plus mà chúng ta buộc phải bỏ tiền ra mua
<a href="https://www.nginx.com/products/session-persistence/" target="_blank" rel="noopener noreferrer">Tham khảo:</a></p><p>Theo một hướng khác, tại sao ta ko dùng ip_hash làm phương thức cân bằng tải ??</p><ul><li>Hash được sinh từ 3 chỉ số đầu của một IP, do đó tất cả IP trong cùng C-class network sẽ đc điều hướng tới cùng một backend.</li><li>Tất cả user phía sau một NAT sẽ truy cập vào cùng một backend.</li><li>Nếu ta thêm mới một backend, toàn bộ hash sẽ thay đổi, đương nhiên session sẽ mất.</li></ul><p>Sau khi tham khảo các bài viết trên mạng thì mình tìm được hướng giải quyết như sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">upstream backend {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    server backend1;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    server backend2;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">map $cookie_backend $sticky_backend {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    backend1 backend1;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    backend2 backend2;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    default backend;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">server {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    listen 80;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    server_name localhost;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    location / {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        set $target http://$sticky_backend;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        proxy_pass $target;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        proxy_set_header Host $host;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        proxy_set_header X-Real-IP $remote_addr;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        proxy_set_header X-Forwarded-Proto $scheme;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Step 1</strong>: Khi user lần đầu tiên truy cập vào Master server, lúc đó sẽ ko có backend cookie nào được đưa ra, và dĩ nhiên $sticky_backend NGINX variable sẽ được chuyển hướng tới upstream group. Trong trường hợp này , request sẽ được chuyển tới Backend 1 hoặc Backend 2 theo phương thức round robin.</p><p><strong>Step 2</strong>: Trên các webserver Backend 1 và Backend 2, ta cấu hình ghi các cookie tương ứng với mỗi request đến:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">server {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    listen 80 default_server;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    location ~ ^/.+\.php(/|$) {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        add_header Set-Cookie &quot;backend=backend1;Max-Age=3600&quot;;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">server {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    listen 80 default_server;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    location ~ ^/.+\.php(/|$) {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        add_header Set-Cookie &quot;backend=backend2;Max-Age=3600&quot;;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Dễ thấy nếu request được pass vào backend nào, thì trên client của user sẽ ghi một cookie có name=backend &amp; value=backend1 or backend2 tương ứng.</p><p><strong>Step 3</strong>: Mỗi khi user request lại tới Master, NGINX sẽ thực hiện map $cookie_backend với $sticky_backend tương ứng và chuyển hướng người dùng vào server đó qua proxy_pass.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="health-checks"></a>Health checks<a class="hash-link" href="#health-checks" title="Direct link to heading">#</a></h3><p>Health checks là thực liên tục việc kiểm tra các server trên upstream được khai báo trong config của bạn để tránh việc điều hướng các request của người dùng vào các server không hoạt động. Tóm lại là việc này nhằm đảm bảo người dùng không nhìn thấy các page thông báo lỗi khi chúng ta tắt đi 1 server nào đó, hoặc server nào đó đột xuất bị lỗi không hoạt động.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">upstream backend {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    server backend1 max_fails=3 fail_timeout=10s;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    server backend2 max_fails=3 fail_timeout=10s;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Việc điều hướng tới server nào đang nắm giữ session dựa vào $sticky_backend, tuy nhiên nếu $sticky_backend=backend1 mà server backend 1 ra đi thì sao ? lúc này ta buộc phải chuyển hướng các user ở backend 1 sang các server backend còn lại. Ở đây mình trigger event set lại $sticky_backend sang server khác khi có lỗi Gateway Time-out xảy ra trên proxy server.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">upstream backend {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    server backend1;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    server backend2;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">server {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    listen 80;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    server_name localhost;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    location / {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        set $target http://$sticky_backend;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        proxy_pass $target;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        # 504 Gateway Time-out</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        error_page 504 = @backend_down;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    location @backend_down {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      proxy_pass http://backend;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Tổng hợp lại file nginx default</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">upstream webserver {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    server webserver_1 max_fails=3 fail_timeout=10s;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    server webserver_2 max_fails=3 fail_timeout=10s;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">map $cookie_backend $sticky_backend {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    backend1 webserver_1;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    backend2 webserver_2;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    default webserver;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">server {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    listen 80;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    server_name localhost;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    location / {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        resolver 127.0.0.1;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        set $target http://$sticky_backend;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        proxy_pass $target;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        proxy_set_header Host $host;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        proxy_set_header X-Real-IP $remote_addr;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        proxy_set_header X-Forwarded-Proto $scheme;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        proxy_connect_timeout 5;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        # 504 Gateway Time-out</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        error_page 504 = @backend_down;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    location @backend_down {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      proxy_pass http://webserver;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/facebook">facebook</a><a class="margin-horiz--sm" href="/blog/tags/hello">hello</a><a class="margin-horiz--sm" href="/blog/tags/docusaurus">docusaurus</a></div><div class="col text--right"><a aria-label="Read more about Sử dụng NGINX làm load balancer" href="/blog/balancer"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/ssl">Let&#x27;s Encrypt SSL</a></h2><div class="margin-vert--md"><time datetime="2021-04-03T00:00:00.000Z" class="blogPostDate_fNvV">April 3, 2021 · 6 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/ttl" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars0.githubusercontent.com/u/1315101?s=400&amp;v=4" alt="congnt"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/ttl" target="_blank" rel="noopener noreferrer">congnt</a></h4><small class="avatar__subtitle">BACKEND</small></div></div></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-cài-đặt-lets-encrypt"></a>1 Cài đặt Let’s Encrypt<a class="hash-link" href="#1-cài-đặt-lets-encrypt" title="Direct link to heading">#</a></h2><ul><li>Chúng ta sẽ clone mã nguồn của Let’s Encrypt về thư mục /opt/letsencrypt. Bước này thực hiện giống nhau trên CentOS 6 và 7.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"># Install Git</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">yum -y install git</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"># Clone Let&#x27;s Encrypt repository</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">git clone https://github.com/letsencrypt/letsencrypt /opt/letsencrypt</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-phát-hành-chứng-chỉ-ssl-lets-encrypt-cho-domain"></a>2 Phát hành chứng chỉ SSL Let’s Encrypt cho domain<a class="hash-link" href="#2-phát-hành-chứng-chỉ-ssl-lets-encrypt-cho-domain" title="Direct link to heading">#</a></h2><ul><li><p>Để phát hành chứng chỉ SSL Let’s Encrypt cho domain có rất nhiều cách, mình sẽ sử dụng option --standalone</p></li><li><p>Cho đến tháng 5, 2016, Certbot được gọi với tên letsencrypt hoặc letsencrypt-auto, tùy thuộc vào cách cài đặt. Một số bài hướng dẫn trên Internet vẫn sử dụng tên cũ này, trong bài hướng dẫn này sẽ sử dụng certbot-auto, tất cả đều tương tự nhau.</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"># Stop Nginx</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">service nginx stop</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"># Issue SSL Let&#x27;s Encrypt</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">/opt/letsencrypt/certbot-auto certonly --standalone</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>Chờ một lúc để Let’s Encrypt cài đặt những công cụ cần thiết. Sau đó bạn hãy nhập địa chỉ email, rồi nhấn phím Enter.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">Saving debug log to /var/log/letsencrypt/letsencrypt.log</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Plugins selected: Authenticator standalone, Installer None</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Enter email address (used for urgent renewal and security notices) (Enter &#x27;c&#x27; to</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">cancel): ttl.cong@1pac.vn</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>Chấp nhận quy định bằng cách nhập a, rồi nhấn tiếp Enter.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">Please read the Terms of Service at</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">agree in order to register with the ACME server at</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">https://acme-v02.api.letsencrypt.org/directory</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">(A)gree/(C)ancel: A</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">Would you be willing to share your email address with the Electronic Frontier</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Foundation, a founding partner of the Let&#x27;s Encrypt project and the non-profit</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">organization that develops Certbot? We&#x27;d like to send you email about our work</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">encrypting the web, EFF news, campaigns, and ways to support digital freedom.</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">(Y)es/(N)o: Y</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>Tiếp theo bạn nhập tên miền sẽ sử dụng chứng chỉ SSL, rồi nhấn Enter. Bước này bạn chỉ nhập phiên bản non-www và www của 1 domain hoặc subdomain. Khi muốn thêm tên miền/subdomain khác bạn hãy xem hướng dẫn bên dưới.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">Please enter in your domain name(s) (comma and/or space separated)  (Enter &#x27;c&#x27;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">to cancel): 1pac.vn www.1pac.vn</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>Nếu không gặp vấn đề gì bạn sẽ gặp thông báo như bên dưới:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">IMPORTANT NOTES:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> - Congratulations! Your certificate and chain have been saved at:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">   /etc/letsencrypt/live/1pac.vn/fullchain.pem</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">   Your key file has been saved at:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">   /etc/letsencrypt/live/1pac.vn/privkey.pem</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">   Your cert will expire on 2019-08-03. To obtain a new or tweaked</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">   version of this certificate in the future, simply run certbot-auto</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">   again. To non-interactively renew *all* of your certificates, run</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">   &quot;certbot-auto renew&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> - Your account credentials have been saved in your Certbot</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">   configuration directory at /etc/letsencrypt. You should make a</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">   secure backup of this folder now. This configuration directory will</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">   also contain certificates and private keys obtained by Certbot so</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">   making regular backups of this folder is ideal.</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> - If you like Certbot, please consider supporting our work by:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">   Donating to ISRG / Let&#x27;s Encrypt:   https://letsencrypt.org/donate</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">   Donating to EFF:                    https://eff.org/donate-le</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ghi-chú-"></a>GHI CHÚ :<a class="hash-link" href="#ghi-chú-" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="lỗi-importerror-no-module-named-cryptography"></a>Lỗi ImportError: No module named cryptography<a class="hash-link" href="#lỗi-importerror-no-module-named-cryptography" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">cd /opt/eff.org/certbot/venv/lib64/python2.7</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">rmdir site-packages (in my case, this directory was empty)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">ln -s dist-packages site-packages</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">rm -rf ~/.local/share/letsencrypt</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">rm -rf /opt/eff.org/*</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="kiểm-tra-các-file-cert-được-sinh-ra"></a>Kiểm tra các file cert được sinh ra<a class="hash-link" href="#kiểm-tra-các-file-cert-được-sinh-ra" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ls /etc/letsencrypt/live/DOMAIN_HERE</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="backup-các-file-cert"></a>Backup các file cert<a class="hash-link" href="#backup-các-file-cert" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp -r /etc/letsencrypt/live/DOMAIN_HERE ../sslcert</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="config-nginx"></a>Config nginx<a class="hash-link" href="#config-nginx" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"># tự động chuyển toàn bộ url http sang https</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">server {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">     listen  80;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">     server_name  localhost;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">     return 301 https://$host$request_uri;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">#cấu hình server https</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">server {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    listen       443 ssl;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    server_name  localhost;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    #use fullchain.pem instead of cert.pem</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    ssl_certificate         /etc/letsencrypt/live/DOMAIN_HERE/fullchain.pem;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    ssl_certificate_key     /etc/letsencrypt/live/DOMAIN_HERE/privkey.pem;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="gia-hạn-ssl-cert"></a>Gia hạn SSL CERT<a class="hash-link" href="#gia-hạn-ssl-cert" title="Direct link to heading">#</a></h3><ul><li>Chứng chỉ Let’s Encrypt chỉ sử dụng được trong vòng 90 ngày và bạn cần phải chạy lại dòng lệnh bên dưới để gia hạn.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">/opt/letsencrypt/certbot-auto renew --pre-hook &quot;service nginx stop&quot; --post-hook &quot;service nginx start&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li><p>Tuy nhiên, mình sẽ hướng dẫn các bạn cấu hình để tự động gia hạn chứng chỉ này với crontab, như vậy chúng ta sẽ sử dụng SSL miễn phí trọn đời mà không cần phải lo về việc gia hạn nữa.</p></li><li><p>Mở file cấu hình crontab:</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> EDITOR=nano crontab -e</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>Copy và paste đoạn code bên dưới vào cửa sổ terminal:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">30 2 * * * /opt/letsencrypt/certbot-auto renew --pre-hook &quot;service nginx stop&quot; --post-hook &quot;service nginx start&quot; &gt;&gt; /var/log/le-renew.log</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Nhấn Ctrl+O, Enter để lưu và Ctrl+X để thoát. Bạn nhận được thông báo sau là thành công</p><p>crontab: installing new crontab
crontab trên sẽ tự động chạy lệnh gia hạn Let’s Encrypt vào lúc 2h30 hàng ngày và kiểm tra xem đã hết hạn chưa và tiến hành gia hạn. Trước khi gia hạn sẽ stop Nginx, sau đó sẽ start lại ngay lập tức. Như vậy, gần như không ảnh hưởng gì cả đến website.</p><p>Vậy là xong, bạn có thể yên tâm sử dụng Let’s Encrypt rồi đấy.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="note"></a>NOTE<a class="hash-link" href="#note" title="Direct link to heading">#</a></h4><p>renew ssl</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ls -la /etc/letsencrypt/live/</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">- domain</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo certbot renew --cert-name domain</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">certbot-auto renew</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="fix"></a>fix<a class="hash-link" href="#fix" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">Step 1. Edit the file /opt/letsencrypt/certbot-auto to recognize your version of Linux:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$  sudo vim /opt/letsencrypt/certbot-auto</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">find this line in the file (likely near line nr 780):</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> elif [ -f /etc/redhat-release ]; then</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">and replace whole line with this:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> elif [ -f /etc/redhat-release ] || grep &#x27;cpe:.*:amazon_linux:2&#x27; /etc/os-release &gt; /dev/null 2&gt;&amp;1; then</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Save and exit vim (type :wq to do that)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Step 2. Run below to obtain your certificates:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo /opt/letsencrypt/certbot-auto certonly --webroot -w </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="refs"></a>Refs<a class="hash-link" href="#refs" title="Direct link to heading">#</a></h4><ul><li>1 <a href="https://hocvps.com/cai-dat-lets-encrypt/" target="_blank" rel="noopener noreferrer">https://hocvps.com/cai-dat-lets-encrypt/</a></li><li>2 <a href="https://dominhhai.github.io/vi/2017/02/free-ssl-with-let-encrypt/" target="_blank" rel="noopener noreferrer">https://dominhhai.github.io/vi/2017/02/free-ssl-with-let-encrypt/</a></li><li>3 <a href="https://github.com/certbot/certbot/issues/2544" target="_blank" rel="noopener noreferrer">https://github.com/certbot/certbot/issues/2544</a> </li><li>4 loi <a href="https://medium.com/@andrenakkurt/great-guide-thanks-for-putting-this-together-gifford-nowland-c3ce0ea2455" target="_blank" rel="noopener noreferrer">https://medium.com/@andrenakkurt/great-guide-thanks-for-putting-this-together-gifford-nowland-c3ce0ea2455</a></li></ul><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>If you have installed <code>@docusaurus/preset-classic</code>, you don&#x27;t need to install it as a dependency.</p></div></div></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/facebook">facebook</a><a class="margin-horiz--sm" href="/blog/tags/hello">hello</a><a class="margin-horiz--sm" href="/blog/tags/docusaurus">docusaurus</a></div><div class="col text--right"><a aria-label="Read more about Let&#x27;s Encrypt SSL" href="/blog/ssl"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/kubeadm">Steps to Install Kubeadm on Ubuntu</a></h2><div class="margin-vert--md"><time datetime="2021-03-08T00:00:00.000Z" class="blogPostDate_fNvV">March 8, 2021 · One min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/ttl" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars0.githubusercontent.com/u/1315101?s=400&amp;v=4" alt="congnt"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/ttl" target="_blank" rel="noopener noreferrer">congnt</a></h4><small class="avatar__subtitle">BACKEND</small></div></div></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="set-up-docker"></a>Set up Docker<a class="hash-link" href="#set-up-docker" title="Direct link to heading">#</a></h2><p><strong>Step 1</strong>: Install Docker
Kubernetes requires an existing Docker installation</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt-get update</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt-get install docker.io</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl enable docker</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl status docker</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl start docker</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="install-kubernetes"></a>Install Kubernetes<a class="hash-link" href="#install-kubernetes" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt-add-repository &quot;deb http://apt.kubernetes.io/ kubernetes-xenial main&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt-get install kubeadm kubelet kubectl</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt-mark hold kubeadm kubelet kubectl</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="kubernetes-deployment"></a>Kubernetes Deployment<a class="hash-link" href="#kubernetes-deployment" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo swapoff –a</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo kubeadm init --pod-network-cidr=10.244.0.0/16</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -p $HOME/.kube</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">sudo kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/facebook">facebook</a><a class="margin-horiz--sm" href="/blog/tags/hello">hello</a><a class="margin-horiz--sm" href="/blog/tags/docusaurus">docusaurus</a></div><div class="col text--right"><a aria-label="Read more about Steps to Install Kubeadm on Ubuntu" href="/blog/kubeadm"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/minikubeancer">Minikube Installation on Ubuntu 16.04 LTS</a></h2><div class="margin-vert--md"><time datetime="2021-03-07T00:00:00.000Z" class="blogPostDate_fNvV">March 7, 2021 · 2 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/ttl" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars0.githubusercontent.com/u/1315101?s=400&amp;v=4" alt="congnt"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/ttl" target="_blank" rel="noopener noreferrer">congnt</a></h4><small class="avatar__subtitle">BACKEND</small></div></div></header><div class="markdown"><p>Overview:</p><ol><li>Install hypervisor (Virtualbox)</li><li>Get and install Kubectl (repositories)</li><li>Get and install Minikube last version</li><li>Start and Test Minikube local cluster and expose demo service</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="install-virtualbox-hypervisor"></a>Install VirtualBox hypervisor<a class="hash-link" href="#install-virtualbox-hypervisor" title="Direct link to heading">#</a></h3><p>We will install virtualbox 5.* via official reposiories</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo apt-get update</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo apt remove virtualbox*</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ wget -q https://www.virtualbox.org/download/oracle_vbox_2016.asc -O- | sudo apt-key add -</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ wget -q https://www.virtualbox.org/download/oracle_vbox.asc -O- | sudo apt-key add -</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo su</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ echo &quot;deb https://download.virtualbox.org/virtualbox/debian xenial contrib&quot; &gt;&gt; /etc/apt/sources.list</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ apt-get update</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo apt-get install virtualbox virtualbox-ext-pack</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="install-kubectl"></a>Install Kubectl<a class="hash-link" href="#install-kubectl" title="Direct link to heading">#</a></h3><p>We will install kubectl from official repositories. Recommened so you will get updates via apt.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo apt-get update &amp;&amp; sudo apt-get install -y apt-transport-https</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo touch /etc/apt/sources.list.d/kubernetes.list</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ echo &quot;deb http://apt.kubernetes.io/ kubernetes-xenial main&quot; | sudo tee -a /etc/apt/sources.list.d/kubernetes.list</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo apt-get update &amp;&amp; sudo apt-get install -y kubectl</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl version</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="install-minikube"></a>Install Minikube<a class="hash-link" href="#install-minikube" title="Direct link to heading">#</a></h3><p>Download minukube binary directly from Google repositories.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 &amp;&amp; chmod +x minikube</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ sudo mv -v minikube /usr/local/bin</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ minikube version</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ exit</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="start-kubernetes-cluster-loccally-with-minikube"></a>Start Kubernetes Cluster loccally with Minikube<a class="hash-link" href="#start-kubernetes-cluster-loccally-with-minikube" title="Direct link to heading">#</a></h3><p>Create and run Kubernetes cluster. This will take some few minutes depending on your Internet connection.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ minikube start</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="test-kubernetes-service"></a>Test Kubernetes service<a class="hash-link" href="#test-kubernetes-service" title="Direct link to heading">#</a></h3><p>We test our cluster running a demo service</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl cluster-info</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl run hello-minikube --image=gcr.io/google_containers/echoserver:1.4 --port=8080</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl expose deployment hello-minikube --type=NodePort</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get services</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ minikube service hello-minikube --url</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ minikube dashboard</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl delete service hello-minikube</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl delete deployment hello-minikube</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ minikube stop</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="adds-kubectl-command-k-alias-to-bash-optional"></a>Adds Kubectl command &#x27;k&#x27; alias to bash (optional)<a class="hash-link" href="#adds-kubectl-command-k-alias-to-bash-optional" title="Direct link to heading">#</a></h3><p>Using command aliases for minikube and kubectl, example: &quot;mk start&quot;, &quot;k get po&quot;. Note: You need to restart
your bash terminal to see aliases working.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ echo &quot;alias k=&#x27;kubectl&#x27;&quot; &gt;&gt; ~/.bash_aliases</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ echo &quot;alias mk=&#x27;minikube&#x27;&quot; &gt;&gt; ~/.bash_aliases</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="documentation-reference"></a>Documentation Reference<a class="hash-link" href="#documentation-reference" title="Direct link to heading">#</a></h3><p>Some documentation and tutorials</p><ul><li><a href="https://kubernetes.io/docs/tasks/tools/install-minikube/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/tasks/tools/install-minikube/</a></li><li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/tasks/tools/install-kubectl/</a></li><li><a href="https://linuxhint.com/install-minikube-ubuntu/" target="_blank" rel="noopener noreferrer">https://linuxhint.com/install-minikube-ubuntu/</a></li><li><a href="https://askubuntu.com/questions/17536/how-do-i-create-a-permanent-bash-alias" target="_blank" rel="noopener noreferrer">https://askubuntu.com/questions/17536/how-do-i-create-a-permanent-bash-alias</a></li><li><a href="https://websiteforstudents.com/install-virtualbox-latest-on-ubuntu-16-04-lts-17-04-17-10/" target="_blank" rel="noopener noreferrer">https://websiteforstudents.com/install-virtualbox-latest-on-ubuntu-16-04-lts-17-04-17-10/</a></li></ul></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/facebook">facebook</a><a class="margin-horiz--sm" href="/blog/tags/hello">hello</a><a class="margin-horiz--sm" href="/blog/tags/docusaurus">docusaurus</a></div><div class="col text--right"><a aria-label="Read more about Minikube Installation on Ubuntu 16.04 LTS" href="/blog/minikubeancer"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/httpaccess">Nginx Protecting directories</a></h2><div class="margin-vert--md"><time datetime="2021-01-24T00:00:00.000Z" class="blogPostDate_fNvV">January 24, 2021 · One min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/ttl" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars0.githubusercontent.com/u/1315101?s=400&amp;v=4" alt="congnt"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/ttl" target="_blank" rel="noopener noreferrer">congnt</a></h4><small class="avatar__subtitle">BACKEND</small></div></div></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="log-into-your-server-via-ssh"></a>Log into your server via SSH.<a class="hash-link" href="#log-into-your-server-via-ssh" title="Direct link to heading">#</a></h2><p>Navigate to your user&#x27;s directory.
Make sure you have a /etc/nginx/example.com directory. This doesn&#x27;t exist by default; you must create it by running the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">[server]$ mkdir -p nginx/example.com</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="add-code-in-etcnginxconfddefaultconf"></a>Add code in /etc/nginx/conf.d/default.conf<a class="hash-link" href="#add-code-in-etcnginxconfddefaultconf" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">  location / {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    auth_basic &quot;Restricted&quot;;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    auth_basic_user_file /home/username/nginx/example.com/.htpasswd;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="run-the-following-to-create-the-htpasswd-file"></a>Run the following to create the .htpasswd file:<a class="hash-link" href="#run-the-following-to-create-the-htpasswd-file" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">[server]$ htpasswd -c /home/username/nginx/example.com/.htpasswd LOGIN</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Reload the nginx config file.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/facebook">facebook</a><a class="margin-horiz--sm" href="/blog/tags/hello">hello</a><a class="margin-horiz--sm" href="/blog/tags/docusaurus">docusaurus</a></div><div class="col text--right"><a aria-label="Read more about Nginx Protecting directories" href="/blog/httpaccess"><strong>Read More</strong></a></div></footer></article></div></main></div></div></div></div>
<script src="/assets/js/runtime~main.2fa7534d.js"></script>
<script src="/assets/js/main.6a1dc008.js"></script>
</body>
</html>